<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Empty Framework</title>
  </head>

  <body>
    <video id="video" autoplay loop webkit-playsinline style="display:none">
      <source src="assets/video/sintel.mp4" type='video/ogg; codecs="theora, vorbis"' />
    </video>
    <script src="https://cdn.bootcss.com/lodash.js/4.17.5/lodash.min.js"></script>
    <script src="../lib/three.min.js"></script>
    <script src="../build/nova.js"></script>
    <script>
      var app = new NOVA.App();

      var camera, scene, renderer;
      var video, texture, material, mesh;
      var composer;
      var mouseX = 0;
      var mouseY = 0;
      var windowHalfX = window.innerWidth / 2;
      var windowHalfY = window.innerHeight / 2;
      var cube_count,
        meshes = [],
        materials = [],
        xgrid = 3,
        ygrid = 1;
      init();

      function init() {
        app.world.camera.position.z = 500;
        var light = new THREE.DirectionalLight(0xffffff);
        light.position.set(0.5, 1, 1)
          .normalize();
        app.world.scene.add(light);

        video = document.getElementById('video');
        texture = new THREE.VideoTexture(video);
        texture.minFilter = THREE.LinearFilter;
        texture.magFilter = THREE.LinearFilter;
        texture.format = THREE.RGBFormat;
        //
        var i, j, ux, uy, ox, oy,
          geometry,
          xsize, ysize;
        ux = 1 / xgrid;
        uy = 1 / ygrid;
        xsize = 480 / xgrid;
        ysize = 204 / ygrid;
        var parameters = { color: 0xffffff, map: texture };
        cube_count = 0;
        for (i = 0; i < xgrid; i++)
          for (j = 0; j < ygrid; j++) {
            ox = i;
            oy = j;
            geometry = new THREE.BoxGeometry(xsize, ysize, xsize);
            change_uvs(geometry, ux, uy, ox, oy);
            materials[cube_count] = new THREE.MeshLambertMaterial(parameters);
            material = materials[cube_count];
            material.saturation = 1 - j / ygrid;
            mesh = new THREE.Mesh(geometry, material);
            mesh.position.x = (i - xgrid / 2 + 0.5) * xsize;
            mesh.position.y = (j - ygrid / 2 + 0.5) * ysize;
            mesh.position.z = 0;
            mesh.scale.set(1, 1, 1);
            app.world.scene.add(mesh);
            meshes[cube_count] = mesh;
            cube_count += 1;
          }
        app.renderer.autoClear = false;
      }

      function change_uvs(geometry, unitx, unity, offsetx, offsety) {
        var faceVertexUvs = geometry.faceVertexUvs[0];
        for (var i = 0; i < faceVertexUvs.length; i++) {
          var uvs = faceVertexUvs[i];
          for (var j = 0; j < uvs.length; j++) {
            var uv = uvs[j];
            uv.x = (uv.x + offsetx) * unitx;
            uv.y = (uv.y + offsety) * unity;
          }
        }
      }

      var h, counter = 1;
    </script>
  </body>

</html>