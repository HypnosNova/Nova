<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Record</title>
    <style>
      button {
        position: fixed
      }
    </style>
  </head>

  <body>
    <button id="btn">Start recording</button>
    <script src="https://cdn.bootcss.com/lodash.js/4.17.5/lodash.min.js"></script>
    <script src="../lib/three.min.js"></script>
    <script src="../build/nova.js"></script>
    <script src="https://cdn.WebRTC-Experiment.com/RecordRTC.js"></script>
    <script src="https://cdn.webrtc-experiment.com/screenshot.js"></script>
    <script>
      let app = new NOVA.App();

      app.world.camera.position.z = 2;
      geometry = new THREE.BoxGeometry( 0.2, 0.2, 0.2 );
      material = new THREE.MeshNormalMaterial();
      mesh = new THREE.Mesh( geometry, material );
      app.world.scene.add( mesh );

      app.logicLoop.add( () => {
        mesh.rotation.x += 0.01;
        mesh.rotation.y += 0.02;
      } );

      let recorder = RecordRTC( app.renderer.domElement, {
        type: 'canvas'
      } );
      let isRecordingStarted = false;

      let btn = document.getElementById( 'btn' );
      btn.onclick = () => {
        isRecordingStarted = !isRecordingStarted;
        if ( isRecordingStarted ) {
          btn.innerText = "Stop recording";
          recorder.startRecording();
        } else {
          btn.innerText = "Start recording";
          recorder.stopRecording( ( url ) => {
            var blob = recorder.getBlob();

            var video = document.createElement( 'video' );
            video.src = URL.createObjectURL( blob );
            video.setAttribute( 'style', 'height: 100%; position: absolute; top:0;' );
            video.controls = true;

            let w = window.open( '', '' );
            w.document.title = "Record video";
            w.document.body.style.padding = "0";
            w.document.body.style.margin = "0";
            w.document.body.appendChild( video );

            video.play();
          } );
        }
      }
    </script>
  </body>

</html>